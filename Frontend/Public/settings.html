<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Settings - SmartSpend</title>

  <!-- CSS -->
  <link rel="stylesheet" href="style.css" />

  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
  <script src="https://kit.fontawesome.com/2d9a2c9d4d.js" crossorigin="anonymous"></script>
</head>
<body>
  <div class="background"></div>

  <div class="dashboard">
    <!-- ============ SIDEBAR ============ -->
    <aside class="sidebar" id="sidebar" aria-label="Main Navigation">
      <div class="top-group">
        <div class="logo">
          <img src="../Assets/logosmartspend.png" alt="SmartSpend Logo">
          <span class="logo-text"></span>
        </div>

        <nav>
          <ul class="menu" id="menu">
            <li class="menu-item"><a href="dashboard.html"><span class="material-symbols-outlined">dashboard</span><span class="label">Dashboard</span></a></li>
            <li class="menu-item"><a href="upload.html"><span class="material-symbols-outlined">upload</span><span class="label">Upload</span></a></li>
            <li class="menu-item"><a href="budget.html"><span class="material-symbols-outlined">account_balance_wallet</span><span class="label">Budget</span></a></li>
            <li class="menu-item"><a href="reports.html"><span class="material-symbols-outlined">assignment</span><span class="label">Reports</span></a></li>
            <li class="menu-item"><a href="logout.html"><span class="material-symbols-outlined">logout</span><span class="label">Logout</span></a></li>
          </ul>
        </nav>
      </div>
    </aside>

    <!-- ============ MAIN ============ -->
    <main class="main">
      <header class="header">
        <div class="left">
          <button class="toggle-btn" id="toggleSidebarBtn" aria-label="Toggle sidebar">
            <i class="fas fa-bars"></i>
          </button>
          <h2 class="page-title">Settings</h2>
        </div>

        <div class="right">
          <div class="user" id="userProfile" tabindex="0">
            <div class="avatar" id="userAvatar"><i class="fas fa-user"></i></div>
            <div class="user-info">
              <h4 id="userName">Eva Ombao</h4>
              <p id="userRole">Student</p>
            </div>
          </div>

          <div class="profile-menu" id="profileMenu" role="menu" aria-hidden="true">
            <ul>
              <li role="menuitem"><a href="profile.html"><i class="fas fa-user"></i> Profile</a></li>
              <li role="menuitem"><a href="settings.html"><i class="fas fa-cog"></i> Settings</a></li>
              <li role="menuitem"><a href="help.html"><i class="fas fa-question-circle"></i> Help</a></li>
              <li role="menuitem"><a href="login.html"><i class="fas fa-sign-out-alt"></i> Log Out</a></li>
            </ul>
          </div>
        </div>
      </header>

      <!-- ============ SETTINGS SECTION ============ -->
      <section class="settings-card glass animate-fade">
        <h3>Account Settings</h3>

        <form class="settings-form">
          <div class="form-group">
            <label for="email">Email</label>
            <input type="email" id="email" value="eva.ombao@example.com" />
          </div>

          <div class="form-group">
            <label for="currentPassword">Current Password</label>
            <input type="password" id="currentPassword" placeholder="Enter current password" />
          </div>

          <div class="form-group">
            <label for="newPassword">New Password</label>
            <input type="password" id="newPassword" placeholder="Enter new password" />
          </div>

          <div class="form-group">
            <label for="confirmPassword">Confirm New Password</label>
            <input type="password" id="confirmPassword" placeholder="Confirm new password" />
          </div>

          <div class="actions">
            <button type="submit" class="btn primary"><i class="fas fa-save"></i> Save Changes</button>
          </div>
        </form>
      </section>
    </main>
  </div>

  <script src="script.js"></script>

  <!-- ✅ Live Sync Header with LocalStorage (Name, Role, and Photo) -->
  <script>
    function updateHeaderFromLocalStorage() {
      const storedProfile = localStorage.getItem("user_profile");
      if (storedProfile) {
        const user = JSON.parse(storedProfile);
        const nameEl = document.querySelector(".user-info h4");
        const roleEl = document.querySelector(".user-info p");
        const avatarEl = document.querySelector(".avatar");

        // ✅ Update name
        if (nameEl && user.full_name) nameEl.textContent = user.full_name;

        // ✅ Update role
        if (roleEl && user.role) roleEl.textContent = user.role;

        // ✅ Update avatar (photo)
        if (avatarEl) {
          if (user.photo) {
            avatarEl.innerHTML = `<img src="${user.photo}" alt="User" style="width:35px;height:35px;border-radius:50%;">`;
          } else {
            avatarEl.innerHTML = `<i class="fas fa-user"></i>`;
          }
        }
      }
    }

    // Load header when page opens
    document.addEventListener("DOMContentLoaded", updateHeaderFromLocalStorage);

    // Live sync when localStorage changes
    window.addEventListener("storage", (e) => {
      if (e.key === "user_profile") updateHeaderFromLocalStorage();
    });
  </script>
</body>
</html>
